<mat-accordion class="w-full">
  <mat-expansion-panel
    (opened)="panelOpenState.set(true)"
    (closed)="panelOpenState.set(false)"
  >
    <mat-expansion-panel-header class="flex-col sm:flex-row">
      <mat-panel-title class="!mr-0"> Filter </mat-panel-title>
      <mat-panel-description>
        @if(!!dateFilterForm.value.fromDate) {
        <span class="mr-4"
          ><strong>From:</strong>
          {{
            datePipe.transform(dateFilterForm.value.fromDate, "yyyy-MM-dd")
          }}</span
        >
        } @if(!!dateFilterForm.value.toDate) {
        <span
          ><strong>To:</strong>
          {{
            datePipe.transform(dateFilterForm.value.toDate, "yyyy-MM-dd")
          }}</span
        >
        }
      </mat-panel-description>
    </mat-expansion-panel-header>
    <form
      [formGroup]="dateFilterForm"
      (ngSubmit)="onSubmit()"
      class="flex flex-col"
    >
      <div class="flex flex-col sm:flex-row sm:items-center sm:gap-2">
        <mat-form-field appearance="fill" class="flex-1">
          <mat-label>From Date</mat-label>
          <input
            matInput
            [matDatepicker]="fromPicker"
            formControlName="fromDate"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="fromPicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #fromPicker></mat-datepicker>
          @if(!!dateFilterForm.value.fromDate) {
          <button mat-icon-button matSuffix (click)="clearDate('fromDate')">
            <mat-icon>clear</mat-icon>
          </button>
          }
        </mat-form-field>

        <mat-form-field appearance="fill" class="mt-2 sm:mt-0">
          <mat-label>To Date</mat-label>
          <input matInput [matDatepicker]="toPicker" formControlName="toDate" />
          <mat-datepicker-toggle
            matSuffix
            [for]="toPicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #toPicker></mat-datepicker>
          @if(!!dateFilterForm.value.toDate) {
          <button mat-icon-button matSuffix (click)="clearDate('toDate')">
            <mat-icon>clear</mat-icon>
          </button>
          }
        </mat-form-field>
      </div>

      @if(dateFilterForm.errors?.dateRangeInvalid){
      <div class="text-red text-sm mt-2 mb-2">
        The from date must be earlier than or equal to the to date.
      </div>
      }

      <div class="flex justify-end">
        <button mat-raised-button color="primary" type="submit" [disabled]="dateFilterForm.invalid">Submit</button>
      </div>
    </form>
  </mat-expansion-panel>
</mat-accordion>
